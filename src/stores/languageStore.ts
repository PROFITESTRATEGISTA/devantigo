import { create } from 'zustand';

type Language = 'en' | 'pt';

interface LanguageState {
  language: Language;
  setLanguage: (language: Language) => void;
  t: (key: string) => string;
}

// Translations dictionary
const translations: Record<Language, Record<string, string>> = {
  en: {
    // Navigation
    'nav.robots': 'My Robots',
    'nav.community': 'Community',
    'nav.profile': 'Profile',
    'nav.subscription': 'Subscription',
    'nav.experts': 'Experts',
    'nav.signOut': 'Sign Out',
    'nav.dashboard': 'Dashboard',
    'nav.faq': 'FAQ',
    
    // Buttons
    'button.createRobot': 'Create Robot',
    'button.newVersion': 'New Version',
    'button.save': 'Save',
    'button.share': 'Share',
    'button.export': 'Export',
    'button.cancel': 'Cancel',
    'button.back': 'Back',
    'button.analyze': 'Analyze',
    'button.upload': 'Upload',
    'button.download': 'Download',
    
    // Robot actions
    'robot.edit': 'Edit',
    'robot.delete': 'Delete',
    'robot.view': 'View',
    'robot.rename': 'Rename',
    'robot.create': 'Create Robot',
    'robot.noRobots': 'No robots found',
    'robot.createFirst': 'Create your first robot to get started',
    
    // Sharing
    'share.title': 'Share Robot',
    'share.permission': 'Permission Level',
    'share.viewOnly': 'View Only',
    'share.canEdit': 'Can Edit',
    'share.generateLink': 'Generate Link',
    'share.inviteByEmail': 'Invite by Email',
    'share.shareLink': 'Share Link',
    
    // AI Assistant
    'ai.title': 'AI Assistant',
    'ai.placeholder': 'Ask me anything...',
    'ai.createRobot': 'Create Robot with AI',
    'ai.configAssistant': 'Configuration Assistant',
    'ai.clearChat': 'Clear Chat',
    'ai.buyTokens': 'Buy Tokens',
    'ai.notEnoughTokens': 'Not enough tokens. Please buy more.',
    'ai.tokenCost': 'Each AI analysis costs 100 tokens',
    
    // Tokens
    'tokens.balance': 'tokens',
    'tokens.buy': 'Buy Tokens',
    'tokens.insufficient': 'Insufficient tokens',
    'tokens.required': 'tokens required',
    
    // Profile
    'profile.title': 'Profile Settings',
    'profile.photo': 'Profile Photo',
    'profile.email': 'Email Address',
    'profile.name': 'Display Name',
    'profile.save': 'Save Changes',
    'profile.phone': 'Phone Number',
    'profile.currentPlan': 'Current Plan',
    
    // Subscription
    'subscription.title': 'Subscription & Tokens',
    'subscription.current': 'Current Plan',
    'subscription.status': 'Status',
    'subscription.renewal': 'Next Renewal',
    'subscription.manage': 'Manage Subscription',
    'subscription.upgrade': 'Upgrade Plan',
    'subscription.tokenBalance': 'Token Balance',
    
    // Analysis
    'analysis.backtest': 'Backtest Analysis',
    'analysis.strategy': 'Strategy Analysis',
    'analysis.upload': 'Upload Data',
    'analysis.results': 'Analysis Results',
    'analysis.metrics': 'Performance Metrics',
    
    // FAQ
    'faq.title': 'Frequently Asked Questions',
    'faq.subtitle': 'Find answers to common questions about the platform',
    'faq.notFound': 'Didn\'t find your answer?',
    'faq.contact': 'Our team is ready to help you with any questions',
    'faq.whatsapp': 'Chat on WhatsApp',
    'faq.email': 'Send Email',
    'faq.backToDashboard': 'Back to Dashboard',
    
    // FAQ Categories
    'faq.category.robots': 'Robot Creation and Management',
    'faq.category.ai': 'AI Assistant',
    'faq.category.analysis': 'Backtest Analysis',
    'faq.category.tokens': 'Tokens and Plans',
    'faq.category.collaboration': 'Collaboration and Sharing',
    'faq.category.technical': 'Technical Support',
    
    // FAQ Questions and Answers
    'faq.robots.q1': 'How to create my first robot?',
    'faq.robots.a1': 'Click "Create Robot" on the robots page, enter a name and start editing. You can use the AI assistant to generate code automatically or program manually in the editor.',
    'faq.robots.q2': 'How many robots can I create?',
    'faq.robots.a2': 'It depends on your plan: Free (5 robots), Pro 1 (25 robots), Pro 2 (100 robots), Pro 3 (500 robots). You can see your current limit in the robots panel.',
    'faq.robots.q3': 'How to share a robot with other users?',
    'faq.robots.a3': 'In the robot editor, click "Share" and choose between generating a public link or inviting specific users by email. You can set view or edit permissions.',
    
    'faq.ai.q1': 'How to use AI to create robots?',
    'faq.ai.a1': 'In the assistant chat, describe your strategy in natural language. For example: "Create a robot that buys when RSI < 30 and sells when RSI > 70". The AI will generate the code automatically.',
    'faq.ai.q2': 'How much does it cost to use AI?',
    'faq.ai.a2': 'Each AI interaction consumes tokens: robot creation (500 tokens), backtest analysis (1000 tokens), strategy optimization (300 tokens). Check your balance in the header.',
    
    'faq.analysis.q1': 'How to upload backtest data?',
    'faq.analysis.a1': 'Go to "Backtest Analysis", drag your CSV file or click to select. The file should contain columns: Date, Entry Price, Exit Price, Result, Direction.',
    'faq.analysis.q2': 'What metrics are calculated?',
    'faq.analysis.a2': 'We calculate Profit Factor, Win Rate, Payoff, Max Drawdown, Sharpe Ratio, Recovery Factor, and analysis by day of week and month.',
    
    // Dashboard
    'dashboard.title': 'Dashboard',
    'dashboard.subtitle': 'Overview of your trading activity',
    'dashboard.myRobots': 'My Robots',
    'dashboard.myRobotsDesc': 'Your trading robots',
    'dashboard.analyses': 'Analyses',
    'dashboard.analysesDesc': 'Backtest and strategy analyses',
    'dashboard.ranking': 'Ranking',
    'dashboard.rankingDesc': 'Performance ranking',
    'dashboard.tutorials': 'Tutorials',
    'dashboard.tutorialsDesc': 'Tutorials and guides',
    'dashboard.marketplace': 'Marketplace',
    'dashboard.marketplaceDesc': 'Strategy marketplace',
    'dashboard.users': 'Users',
    'dashboard.usersDesc': 'User community',
    'dashboard.searchRobots': 'Search robots...',
    'dashboard.createRobot': 'Create Robot',
    'dashboard.noRobotsFound': 'No robots found',
    'dashboard.noRobotsCreated': 'No robots created',
    'dashboard.noRobotsSearch': 'No robots match the search',
    'dashboard.createFirstRobot': 'Create your first robot to get started',
    'dashboard.createFirstRobotBtn': 'Create First Robot',
    'dashboard.updatedToday': 'Updated today',
    'dashboard.updatedYesterday': 'Updated yesterday',
    'dashboard.updatedDaysAgo': 'Updated {days} days ago',
    'dashboard.you': 'You',
    'dashboard.viewAllRobots': 'View All Robots',
    
    // Analyses Section
    'analyses.title': 'Recent Analyses',
    'analyses.subtitle': 'Your latest backtest and strategy analyses',
    'analyses.newAnalysis': 'New Analysis',
    'analyses.backtestAnalysis': 'Backtest Analysis',
    'analyses.strategyAnalysis': 'Strategy Analysis',
    'analyses.viewAnalysis': 'View Analysis',
    'analyses.noAnalyses': 'No analyses found',
    'analyses.createFirst': 'Create your first analysis to get started',
    'analyses.profitFactor': 'Profit Factor',
    'analyses.winRate': 'Win Rate',
    'analyses.addToRanking': 'Add to Ranking',
    'analyses.sharpeRatio': 'Sharpe Ratio',
    'analyses.recoveryFactor': 'Recovery Factor',
    'analyses.maxDrawdown': 'Max Drawdown',
    'analyses.totalTrades': 'Total Trades',
    
    // Ranking Section
    'ranking.title': 'Performance Ranking',
    'ranking.subtitle': 'Top performing strategies from the community',
    'ranking.participate': 'Participate',
    'ranking.joinRanking': 'Join Ranking',
    'ranking.viewStrategy': 'View Strategy',
    'ranking.noStrategies': 'No strategies found',
    'ranking.filters': 'Filters',
    'ranking.sortBy': 'Sort by',
    'ranking.order': 'Order',
    'ranking.period': 'Period',
    'ranking.category': 'Category',
    'ranking.highestToLowest': 'Highest to Lowest',
    'ranking.lowestToHighest': 'Lowest to Highest',
    'ranking.allTime': 'All Time',
    'ranking.thisWeek': 'This Week',
    'ranking.thisMonth': 'This Month',
    'ranking.thisYear': 'This Year',
    'ranking.allCategories': 'All Categories',
    'ranking.scalping': 'Scalping',
    'ranking.swingTrading': 'Swing Trading',
    'ranking.trendFollowing': 'Trend Following',
    
    // Tutorials Section
    'tutorials.title': 'Tutorials and Guides',
    'tutorials.subtitle': 'Learn trading strategies and platform features',
    'tutorials.watch': 'Watch',
    'tutorials.duration': 'Duration',
    'tutorials.author': 'Author',
    'tutorials.difficulty': 'Difficulty',
    'tutorials.beginner': 'Beginner',
    'tutorials.intermediate': 'Intermediate',
    'tutorials.advanced': 'Advanced',
    'tutorials.noTutorials': 'No tutorials available',
    
    // Marketplace Section
    'marketplace.title': 'Strategy Marketplace',
    'marketplace.subtitle': 'Discover strategies from expert traders',
    'marketplace.rating': 'Rating',
    'marketplace.strategies': 'strategies',
    'marketplace.viewPartner': 'View Partner',
    'marketplace.explorePartner': 'Explore Partner',
    'marketplace.noPartners': 'No partners available',
    
    // Users Section
    'users.title': 'User Community',
    'users.subtitle': 'Connect with other traders',
    'users.searchUsers': 'Search users...',
    'users.connect': 'Connect',
    'users.shareAnalysis': 'Share Analysis',
    'users.shareRobot': 'Share Robot',
    'users.location': 'Location',
    'users.specialty': 'Specialty',
    'users.noUsers': 'No users found',
    'users.noUsersSearch': 'No users match your search',
    
    // Misc
    'loading': 'Loading...',
    'error': 'An error occurred',
    'success': 'Success!',
    'search': 'Search...',
    'filter': 'Filter',
    'sort': 'Sort',
    'actions': 'Actions',
  },
  pt: {
    // Navigation
    'nav.robots': 'Meus Rob√¥s',
    'nav.community': 'Comunidade',
    'nav.profile': 'Perfil',
    'nav.subscription': 'Assinatura',
    'nav.experts': 'Especialistas',
    'nav.signOut': 'Sair',
    'nav.dashboard': 'Dashboard',
    'nav.faq': 'FAQ',
    
    // Buttons
    'button.createRobot': 'Criar Rob√¥',
    'button.newVersion': 'Nova Vers√£o',
    'button.save': 'Salvar',
    'button.share': 'Compartilhar',
    'button.export': 'Exportar',
    'button.cancel': 'Cancelar',
    'button.back': 'Voltar',
    'button.analyze': 'Analisar',
    'button.upload': 'Enviar',
    'button.download': 'Baixar',
    
    // Robot actions
    'robot.edit': 'Editar',
    'robot.delete': 'Excluir',
    'robot.view': 'Visualizar',
    'robot.rename': 'Renomear',
    'robot.create': 'Criar Rob√¥',
    'robot.noRobots': 'Nenhum rob√¥ encontrado',
    'robot.createFirst': 'Crie seu primeiro rob√¥ para come√ßar',
    
    // Sharing
    'share.title': 'Compartilhar Rob√¥',
    'share.permission': 'N√≠vel de Permiss√£o',
    'share.viewOnly': 'Apenas Visualiza√ß√£o',
    'share.canEdit': 'Pode Editar',
    'share.generateLink': 'Gerar Link',
    'share.inviteByEmail': 'Convidar por Email',
    'share.shareLink': 'Link de Compartilhamento',
    
    // AI Assistant
    'ai.title': 'Assistente de IA',
    'ai.placeholder': 'Pergunte-me qualquer coisa...',
    'ai.createRobot': 'Criar Rob√¥ com IA',
    'ai.configAssistant': 'Assistente de Configura√ß√£o',
    'ai.clearChat': 'Limpar Chat',
    'ai.buyTokens': 'Comprar Tokens',
    'ai.notEnoughTokens': 'Tokens insuficientes. Por favor, compre mais.',
    'ai.tokenCost': 'Cada an√°lise de IA custa 100 tokens',
    
    // Tokens
    'tokens.balance': 'tokens',
    'tokens.buy': 'Comprar Tokens',
    'tokens.insufficient': 'Tokens insuficientes',
    'tokens.required': 'tokens necess√°rios',
    
    // Profile
    'profile.title': 'Configura√ß√µes de Perfil',
    'profile.photo': 'Foto de Perfil',
    'profile.email': 'Endere√ßo de Email',
    'profile.name': 'Nome de Exibi√ß√£o',
    'profile.save': 'Salvar Altera√ß√µes',
    'profile.phone': 'Telefone',
    'profile.currentPlan': 'Plano Atual',
    
    // Subscription
    'subscription.title': 'Assinatura e Tokens',
    'subscription.current': 'Plano Atual',
    'subscription.status': 'Status',
    'subscription.renewal': 'Pr√≥xima Renova√ß√£o',
    'subscription.manage': 'Gerenciar Assinatura',
    'subscription.upgrade': 'Atualizar Plano',
    'subscription.tokenBalance': 'Saldo de Tokens',
    
    // Analysis
    'analysis.backtest': 'An√°lise de Backtest',
    'analysis.strategy': 'An√°lise de Estrat√©gia',
    'analysis.upload': 'Enviar Dados',
    'analysis.results': 'Resultados da An√°lise',
    'analysis.metrics': 'M√©tricas de Performance',
    
    // FAQ
    'faq.title': 'Perguntas Frequentes',
    'faq.subtitle': 'Encontre respostas para as d√∫vidas mais comuns sobre a plataforma',
    'faq.notFound': 'N√£o encontrou sua resposta?',
    'faq.contact': 'Nossa equipe est√° pronta para ajudar voc√™ com qualquer d√∫vida',
    'faq.whatsapp': 'Falar no WhatsApp',
    'faq.email': 'Enviar Email',
    'faq.backToDashboard': 'Voltar ao Dashboard',
    
    // FAQ Categories
    'faq.category.robots': 'Cria√ß√£o e Gerenciamento de Rob√¥s',
    'faq.category.ai': 'Assistente de IA',
    'faq.category.analysis': 'An√°lise de Backtest',
    'faq.category.tokens': 'Tokens e Planos',
    'faq.category.collaboration': 'Colabora√ß√£o e Compartilhamento',
    'faq.category.technical': 'Suporte T√©cnico',
    
    // FAQ Questions and Answers
    'faq.robots.q1': 'Como criar meu primeiro rob√¥?',
    'faq.robots.a1': 'Clique em "Criar Rob√¥" na p√°gina de rob√¥s, digite um nome e comece a editar. Voc√™ pode usar o assistente de IA para gerar c√≥digo automaticamente ou programar manualmente no editor.',
    'faq.robots.q2': 'Quantos rob√¥s posso criar?',
    'faq.robots.a2': 'Depende do seu plano: Free (5 rob√¥s), Pro 1 (25 rob√¥s), Pro 2 (100 rob√¥s), Pro 3 (500 rob√¥s). Voc√™ pode ver seu limite atual no painel de rob√¥s.',
    'faq.robots.q3': 'Como compartilhar um rob√¥ com outros usu√°rios?',
    'faq.robots.a3': 'No editor do rob√¥, clique em "Compartilhar" e escolha entre gerar um link p√∫blico ou convidar usu√°rios espec√≠ficos por email. Voc√™ pode definir permiss√µes de visualiza√ß√£o ou edi√ß√£o.',
    
    'faq.ai.q1': 'Como usar a IA para criar rob√¥s?',
    'faq.ai.a1': 'No chat do assistente, descreva sua estrat√©gia em linguagem natural. Por exemplo: "Crie um rob√¥ que compra quando RSI < 30 e vende quando RSI > 70". A IA gerar√° o c√≥digo automaticamente.',
    'faq.ai.q2': 'Quanto custa usar a IA?',
    'faq.ai.a2': 'Cada intera√ß√£o com a IA consome tokens: cria√ß√£o de rob√¥ (500 tokens), an√°lise de backtest (1000 tokens), otimiza√ß√£o de estrat√©gia (300 tokens). Consulte seu saldo no header.',
    
    'faq.analysis.q1': 'Como fazer upload de dados de backtest?',
    'faq.analysis.a1': 'V√° para "Backtest Analysis", arraste seu arquivo CSV ou clique para selecionar. O arquivo deve conter colunas: Data, Pre√ßo Entrada, Pre√ßo Sa√≠da, Resultado, Dire√ß√£o.',
    'faq.analysis.q2': 'Que m√©tricas s√£o calculadas?',
    'faq.analysis.a2': 'Calculamos Profit Factor, Win Rate, Payoff, Max Drawdown, Sharpe Ratio, Recovery Factor, e an√°lises por dia da semana e m√™s.',
    
    // Dashboard
    'dashboard.title': 'Dashboard',
    'dashboard.subtitle': 'Vis√£o geral da sua atividade de trading',
    'dashboard.myRobots': 'Meus Rob√¥s',
    'dashboard.myRobotsDesc': 'Seus rob√¥s de trading',
    'dashboard.analyses': 'An√°lises',
    'dashboard.analysesDesc': 'An√°lises de backtest e estrat√©gias',
    'dashboard.ranking': 'Ranking',
    'dashboard.rankingDesc': 'Ranking de performance',
    'dashboard.tutorials': 'Tutoriais',
    'dashboard.tutorialsDesc': 'Tutoriais e guias',
    'dashboard.marketplace': 'Marketplace',
    'dashboard.marketplaceDesc': 'Marketplace de estrat√©gias',
    'dashboard.users': 'Usu√°rios',
    'dashboard.usersDesc': 'Comunidade de usu√°rios',
    'dashboard.searchRobots': 'Buscar rob√¥s...',
    'dashboard.createRobot': 'Criar Rob√¥',
    'dashboard.noRobotsFound': 'Nenhum rob√¥ encontrado',
    'dashboard.noRobotsCreated': 'Nenhum rob√¥ criado',
    'dashboard.noRobotsSearch': 'Nenhum rob√¥ corresponde √† busca',
    'dashboard.createFirstRobot': 'Crie seu primeiro rob√¥ para come√ßar',
    'dashboard.createFirstRobotBtn': 'Criar Primeiro Rob√¥',
    'dashboard.updatedToday': 'Atualizado hoje',
    'dashboard.updatedYesterday': 'Atualizado ontem',
    'dashboard.updatedDaysAgo': 'Atualizado h√° {days} dias',
    'dashboard.you': 'Voc√™',
    'dashboard.viewAllRobots': 'Ver Todos os Rob√¥s',
    
    // Analyses Section
    'analyses.title': 'An√°lises Recentes',
    'analyses.subtitle': 'Suas √∫ltimas an√°lises de backtest e estrat√©gias',
    'analyses.newAnalysis': 'Nova An√°lise',
    'analyses.backtestAnalysis': 'An√°lise de Backtest',
    'analyses.strategyAnalysis': 'An√°lise de Estrat√©gia',
    'analyses.viewAnalysis': 'Ver An√°lise',
    'analyses.noAnalyses': 'Nenhuma an√°lise encontrada',
    'analyses.createFirst': 'Crie sua primeira an√°lise para come√ßar',
    'analyses.profitFactor': 'Fator de Lucro',
    'analyses.winRate': 'Taxa de Acerto',
    'analyses.addToRanking': 'Adicionar ao Ranking',
    'analyses.sharpeRatio': 'Sharpe Ratio',
    'analyses.recoveryFactor': 'Fator de Recupera√ß√£o',
    'analyses.maxDrawdown': 'Drawdown M√°ximo',
    'analyses.totalTrades': 'Total de Trades',
    
    // Ranking Section
    'ranking.title': 'Ranking de Performance',
    'ranking.subtitle': 'Estrat√©gias com melhor desempenho da comunidade',
    'ranking.participate': 'Participar',
    'ranking.joinRanking': 'Entrar no Ranking',
    'ranking.viewStrategy': 'Ver Estrat√©gia',
    'ranking.noStrategies': 'Nenhuma estrat√©gia encontrada',
    'ranking.filters': 'Filtros',
    'ranking.sortBy': 'Ordenar por',
    'ranking.order': 'Ordem',
    'ranking.period': 'Per√≠odo',
    'ranking.category': 'Categoria',
    'ranking.highestToLowest': 'Maior para Menor',
    'ranking.lowestToHighest': 'Menor para Maior',
    'ranking.allTime': 'Todos os Tempos',
    'ranking.thisWeek': 'Esta Semana',
    'ranking.thisMonth': 'Este M√™s',
    'ranking.thisYear': 'Este Ano',
    'ranking.allCategories': 'Todas as Categorias',
    'ranking.scalping': 'Scalping',
    'ranking.swingTrading': 'Swing Trading',
    'ranking.trendFollowing': 'Trend Following',
    
    // Tutorials Section
    'tutorials.title': 'Tutoriais e Guias',
    'tutorials.subtitle': 'Aprenda estrat√©gias de trading e recursos da plataforma',
    'tutorials.watch': 'Assistir',
    'tutorials.duration': 'Dura√ß√£o',
    'tutorials.author': 'Autor',
    'tutorials.difficulty': 'Dificuldade',
    'tutorials.beginner': 'Iniciante',
    'tutorials.intermediate': 'Intermedi√°rio',
    'tutorials.advanced': 'Avan√ßado',
    'tutorials.noTutorials': 'Nenhum tutorial dispon√≠vel',
    
    // Marketplace Section
    'marketplace.title': 'Marketplace de Estrat√©gias',
    'marketplace.subtitle': 'Descubra estrat√©gias de traders especialistas',
    'marketplace.rating': 'Avalia√ß√£o',
    'marketplace.strategies': 'estrat√©gias',
    'marketplace.viewPartner': 'Ver Parceiro',
    'marketplace.explorePartner': 'Conhecer Parceiro',
    'marketplace.noPartners': 'Nenhum parceiro dispon√≠vel',
    
    // Users Section
    'users.title': 'Comunidade de Usu√°rios',
    'users.subtitle': 'Conecte-se com outros traders',
    'users.searchUsers': 'Buscar usu√°rios...',
    'users.connect': 'Conectar',
    'users.shareAnalysis': 'Compartilhar An√°lise',
    'users.shareRobot': 'Compartilhar Rob√¥',
    'users.location': 'Localiza√ß√£o',
    'users.specialty': 'Especialidade',
    'users.noUsers': 'Nenhum usu√°rio encontrado',
    'users.noUsersSearch': 'Nenhum usu√°rio corresponde √† busca',
    
    // Misc
    'loading': 'Carregando...',
    'error': 'Ocorreu um erro',
    'success': 'Sucesso!',
    'search': 'Buscar...',
    'filter': 'Filtrar',
    'sort': 'Ordenar',
    'actions': 'A√ß√µes',
  }
};

export const useLanguageStore = create<LanguageState>((set, get) => ({
  language: 'en', // Default language
  
  setLanguage: (language: Language) => {
    set({ language });
    // Save to localStorage for persistence
    localStorage.setItem('preferredLanguage', language);
    
    // Trigger a custom event to notify all components
    window.dispatchEvent(new CustomEvent('languageChanged', { detail: language }));
  },
  
  t: (key: string) => {
    const { language } = get();
    return translations[language][key] || translations['en'][key] || key;
  }
}));

// Initialize language from localStorage if available
if (typeof window !== 'undefined') {
  const savedLanguage = localStorage.getItem('preferredLanguage') as Language;
  if (savedLanguage && (savedLanguage === 'en' || savedLanguage === 'pt')) {
    useLanguageStore.getState().setLanguage(savedLanguage);
  }
}